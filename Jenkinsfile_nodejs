pipeline {
    agent any

    environment {
       def VERSION = ''  // Declare an empty environment variable
    }

    stages {
        stage('env_variable') {
            steps {
                script {
                    // Read the version from package.json
                    def packjson_version = readJSON file: 'package.json'
                    // Set the environment variable dynamically
                      VERSION = packjson_version.version
                }
            }
        }

        stage('init') {
            steps {
                sh 'ls -ltr'
            }
        }

        stage('build') {
            steps {
                sh """
                export PATH=\$PATH:/usr/local/bin
                npm --version
                npm install
                ls -ltr
                echo "Version from package.json: ${VERSION}"
                """
            }
        }
    }

    post {
        always {
            echo "I will always say Hello again"
        }

        success {
            echo 'I will run when the pipeline is successful'
        }

        failure {
            echo "I will run when the pipeline fails"
        }
    }
}
